<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>CPP Primer Reading Log: IO &#8211; Chaoyu Wang</title> <meta name="description" content="Moon is a minimal, one column jekyll theme for your blog."> <meta name="keywords" content="reading log, cpp"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="https://planck35.github.io/assets/img/planck.png"> <meta name="twitter:title" content="CPP Primer Reading Log: IO"> <meta name="twitter:description" content="Personal reading log."> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="CPP Primer Reading Log: IO"> <meta property="og:description" content="Personal reading log."> <meta property="og:url" content="https://planck35.github.io/reading-log-io/"> <meta property="og:site_name" content="Chaoyu Wang"> <meta property="og:image" content="https://planck35.github.io/assets/img/planck.png"> <link rel="canonical" href="https://planck35.github.io/reading-log-io/"> <link href="https://planck35.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Chaoyu Wang Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="https://planck35.github.io/assets/css/main.css"> <!-- JS --> <script src="https://planck35.github.io/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="https://planck35.github.io/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="https://planck35.github.io/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="https://planck35.github.io/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="https://planck35.github.io/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="https://planck35.github.io/favicon.png" /> <link rel="shortcut icon" href="https://planck35.github.io/favicon.ico" /> <!-- Background Image --> <style type="text/css">body {background-image:url(https://planck35.github.io/assets/img/cmu-tartan-swatch.png); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="https://planck35.github.io/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="https://planck35.github.io/assets/img/planck.png" alt="Chaoyu Wang photo" class="author-photo"> <h4>Chaoyu Wang</h4> <p>Moon is a minimal, one column jekyll theme for your blog.</p> </li> <li><a href="https://planck35.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://linkedin.com/in/chaoyuw" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/Planck35" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> <li> <a href="http://stackoverflow.com/users/9555758/planck35 from a "http://stackoverflow.com/users/9555758/planck35" link" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-stack-overflow"></i> StackOverflow</a> </li> </ul><!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="https://planck35.github.io/posts/">All Posts</a></li> <li><a href="https://planck35.github.io/tags/">All Tags</a></li> </ul> </li> <li><a href="https://planck35.github.io/projects/" >Projects</a></li> <li><a href="https://planck35.github.io/blog/" >Blog</a></li> </ul><!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>CPP Primer Reading Log: IO</h1> <h4>25 Dec 2019</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~5 minutes </p><!-- /.entry-reading-time --> <a class="btn zoombtn" href="https://planck35.github.io/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p class="notice">Merry Christmas</p> <blockquote> <p>2019/12/25 IO, cpp primer: 398 -</p> </blockquote> <h2 id="no-copy-or-assign-for-io-objects">No Copy or Assign for IO Objects</h2> <p>We cannot copy or assign objects of the IO types</p> <figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="n">ofstream</span> <span class="n">out1</span><span class="p">,</span> <span class="n">out2</span><span class="p">;</span>
<span class="n">out1</span> <span class="o">=</span> <span class="n">out2</span><span class="p">;</span> <span class="c1">// error: cannot assign stream objects
</span><span class="n">ofstream</span> <span class="n">print</span><span class="p">(</span><span class="n">ofstream</span><span class="p">);</span> <span class="c1">// error: can't initialize the ofstream parameter
</span><span class="n">out2</span> <span class="o">=</span> <span class="n">print</span><span class="p">(</span><span class="n">out2</span><span class="p">);</span> <span class="o">//</span> <span class="n">error</span><span class="o">:</span> <span class="n">cannot</span> <span class="n">copy</span> <span class="n">stream</span> <span class="n">objects</span></code></pre></figure> <p>Because we can’t copy the IO types, we <strong>cannot have a parameter or return type</strong> that is one of the stream types. Functions that do IO typically pass and return the stream through references. Reading or writing an IO object changes its state, so the reference <strong>must not be</strong> <code class="highlighter-rouge">const</code>.</p> <p>The <code class="highlighter-rouge">badbit</code> indicates a system-level failure, such as an unrecoverable read or write error. It is usually not possible to use a stream once <code class="highlighter-rouge">badbit</code> has been set.</p> <p>The <code class="highlighter-rouge">failbit</code> is set after a recoverable error, such as reading a character when numeric data was expected. It is often possible to correct such problems and continue using the stream.</p> <p>Reaching end-of-file sets both <code class="highlighter-rouge">eofbit</code> and <code class="highlighter-rouge">failbit</code>.</p> <p>The <code class="highlighter-rouge">goodbit</code>, which is guaranteed to have the value 0, indicates no failures on the stream. If any of badbit, failbit, or eofbit are set, then a condition that evaluates that stream will fail.</p> <p>There are several conditions that cause the standard output buffer to be flushed - that is, to be written to the <strong>actual output device or file</strong>:</p> <ul> <li>The program completes normally.</li> <li>The buffer can become full, in which case it will be flushed before writing the next value.</li> <li>Flush the buffer explicitly using a manipulator such as <code class="highlighter-rouge">endl</code>.</li> <li>Use the <code class="highlighter-rouge">unitbuf</code> manipulator to set the stream’s internal state to empty the buffer after each output operation. By default, <code class="highlighter-rouge">unitbuf</code> is set for <code class="highlighter-rouge">cerr</code>, so that writes to <code class="highlighter-rouge">cerr</code> are flushed immediately.</li> <li>An output stream might be tied to another stream. In this case, the buffer of the tied stream is flushed whenever the tied stream is read or written. By default, <code class="highlighter-rouge">cin</code> and <code class="highlighter-rouge">cerr</code> are both tied to <code class="highlighter-rouge">cout</code>. Hence, reading <code class="highlighter-rouge">cin</code> or writing to <code class="highlighter-rouge">cerr</code> flushes the buffer in <code class="highlighter-rouge">cout</code>.</li> </ul> <p>Some extra manipulators add extra char at the end of the prepending strings.</p> <figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"hi!"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">// writes hi and a newline, then flushes the buffer
</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"hi!"</span> <span class="o">&lt;&lt;</span> <span class="n">flush</span><span class="p">;</span> <span class="c1">// writes hi, then flushes the buffer; adds no data
</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"hi!"</span> <span class="o">&lt;&lt;</span> <span class="n">ends</span><span class="p">;</span> <span class="o">//</span> <span class="n">writes</span> <span class="n">hi</span> <span class="n">and</span> <span class="n">a</span> <span class="n">null</span><span class="p">,</span> <span class="n">then</span> <span class="n">flushes</span> <span class="n">the</span> <span class="n">buffer</span></code></pre></figure> <h2 id="the-unitbuf-manipulator">The unitbuf Manipulator</h2> <p>If we want to flush after every output, we can use the <code class="highlighter-rouge">unitbuf</code> manipulator. This manipulator tells the stream to do a <code class="highlighter-rouge">flush</code> after every subsequent write. The <code class="highlighter-rouge">nounitbuf</code> manipulator restores the stream to use normal, system-managed buffer flushing:</p> <figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">unitbuf</span><span class="p">;</span> <span class="c1">// all writes will be flushed immediately
// any output is flushed immediately, no buffering
</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">nounitbuf</span><span class="p">;</span> <span class="o">//</span> <span class="n">returns</span> <span class="n">to</span> <span class="n">normal</span> <span class="n">buffering</span></code></pre></figure> <p class="notice">Output buffers are not flushed if the program terminates abnormally.</p> <h2 id="tying-input-and-output-streams-together">Tying Input and Output Streams Together</h2> <p>When an input stream is tied to an output stream, any attempt to read the input stream will first flush the buffer associated with the output stream. The library ties <code class="highlighter-rouge">cout</code> to <code class="highlighter-rouge">cin</code>, so the statement</p> <figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">ival</span><span class="p">;</span></code></pre></figure> <p>causes the buffer associated with <code class="highlighter-rouge">cout</code> to be flushed.</p> <p class="notice">Interactive systems usually should tie their input stream to their output stream. Doing so means that all output, which might include prompts to the user, will be written before attempting to read the input.</p> <p>There are two overloaded versions of <code class="highlighter-rouge">tie</code>: One version takes no argument and returns a pointer to the output stream, if any, to which this object is currently tied. The function returns the null pointer if the stream is not tied.</p> <p>The second version of <code class="highlighter-rouge">tie</code> takes a pointer to an <code class="highlighter-rouge">ostream</code> and ties itself to that <code class="highlighter-rouge">ostream</code>. That is, <code class="highlighter-rouge">x.tie(&amp;o)</code> ties the stream <code class="highlighter-rouge">x</code> to the output stream <code class="highlighter-rouge">o</code>.</p> <p>We can tie either an <code class="highlighter-rouge">istream</code> or an <code class="highlighter-rouge">ostream</code> object to another <code class="highlighter-rouge">ostream</code>:</p> <figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cout</span><span class="p">);</span> <span class="c1">// illustration only: the library ties cin and cout for us
// old_tie points to the stream (if any) currently tied to cin
</span><span class="n">ostream</span> <span class="o">*</span><span class="n">old_tie</span> <span class="o">=</span> <span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="nb">nullptr</span><span class="p">);</span> <span class="c1">// cin is no longer tied
// ties cin and cerr; not a good idea because cin should be tied to cout
</span><span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cerr</span><span class="p">);</span> <span class="c1">// reading cin flushes cerr, not cout
</span><span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="n">old_tie</span><span class="p">);</span> <span class="o">//</span> <span class="n">reestablish</span> <span class="n">normal</span> <span class="n">tie</span> <span class="n">between</span> <span class="n">cin</span> <span class="n">and</span> <span class="n">cout</span></code></pre></figure> <p>To tie a given stream to a new output stream, we pass <code class="highlighter-rouge">tie</code> a pointer to the new stream. To untie the stream completely, we pass a null pointer. Each stream can be tied to at most one stream at a time. However, multiple streams can tie themselves to the same <code class="highlighter-rouge">ostream</code>.</p> <p>When an <code class="highlighter-rouge">fstream</code> object is destroyed, <code class="highlighter-rouge">close</code> is called automatically.</p> <h2 id="opening-a-file-in-out-mode-discards-existing-data">Opening a File in <code class="highlighter-rouge">out</code> Mode Discards Existing Data</h2> <p>By default, a file opened in <code class="highlighter-rouge">out</code> mode is truncated even if we do not specify <code class="highlighter-rouge">trunc</code>. To preserve the contents of a file opened with <code class="highlighter-rouge">out</code>, either we must also specify <code class="highlighter-rouge">app</code>, in which case we can write only at the end of the file, or we must also specify <code class="highlighter-rouge">in</code>, in which case the file is open for both input and output.</p> <p>By default, when we open an <code class="highlighter-rouge">ofstream</code>, the contents of the file are discarded. The only way to prevent an <code class="highlighter-rouge">ostream</code> from emptying the given file is to specify <code class="highlighter-rouge">app</code>:</p> <figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="c1">// file1 is truncated in each of these cases
</span><span class="n">ofstream</span> <span class="n">out</span><span class="p">(</span><span class="s">"file1"</span><span class="p">);</span> <span class="c1">// out and trunc are implicit
</span><span class="n">ofstream</span> <span class="n">out2</span><span class="p">(</span><span class="s">"file1"</span><span class="p">,</span> <span class="n">ofstream</span><span class="o">::</span><span class="n">out</span><span class="p">);</span> <span class="c1">// trunc is implicit
</span><span class="n">ofstream</span> <span class="n">out3</span><span class="p">(</span><span class="s">"file1"</span><span class="p">,</span> <span class="n">ofstream</span><span class="o">::</span><span class="n">out</span> <span class="o">|</span> <span class="n">ofstream</span><span class="o">::</span><span class="n">trunc</span><span class="p">);</span>
<span class="c1">// to preserve the file's contents, we must explicitly specify app mode
</span><span class="n">ofstream</span> <span class="n">app</span><span class="p">(</span><span class="s">"file2"</span><span class="p">,</span> <span class="n">ofstream</span><span class="o">::</span><span class="n">app</span><span class="p">);</span> <span class="c1">// out is implicit
</span><span class="n">ofstream</span> <span class="n">app2</span><span class="p">(</span><span class="s">"file2"</span><span class="p">,</span> <span class="n">ofstream</span><span class="o">::</span><span class="n">out</span> <span class="o">|</span> <span class="n">ofstream</span><span class="o">::</span><span class="n">app</span><span class="p">);</span></code></pre></figure> <p class="notice">The only way to preserve the existing data in a file opened by an <code class="highlighter-rouge">ofstream</code> is to specify <code class="highlighter-rouge">app</code> or <code class="highlighter-rouge">in</code> mode explicitly.</p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="https://planck35.github.io/tags/#reading log" title="Pages tagged reading log" class="tag"><span class="term">reading log</span></a><a href="https://planck35.github.io/tags/#cpp" title="Pages tagged cpp" class="tag"><span class="term">cpp</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://planck35.github.io/reading-log-io/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=https://planck35.github.io/reading-log-io/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=https://planck35.github.io/reading-log-io/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> </header> <!-- JS --> <script src="https://planck35.github.io/assets/js/jquery-1.12.0.min.js"></script> <script src="https://planck35.github.io/assets/js/jquery.dlmenu.min.js"></script> <script src="https://planck35.github.io/assets/js/jquery.goup.min.js"></script> <script src="https://planck35.github.io/assets/js/jquery.magnific-popup.min.js"></script> <script src="https://planck35.github.io/assets/js/jquery.fitvid.min.js"></script> <script src="https://planck35.github.io/assets/js/scripts.js"></script> <script type="text/javascript"> var disqus_shortname = 'taylantatli'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
